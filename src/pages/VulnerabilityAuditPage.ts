/**
 * VulnerabilityAuditPage - Vulnerability Audit with filters
 * Language-agnostic selectors support both EN and JA
 */

import { BasePage } from "./BasePage";
import { Control } from "../types/controls.types";

export class VulnerabilityAuditPage extends BasePage {
  protected url = "http://35.74.242.225:20010/dashboard/vulnerability-audit";

  private controls = {
    // Filter section
    filtersHeading: {
      type: "heading",
      css: 'h3:has-text("Filters"), h3:has-text("フィルタ")',
      description: "Filters heading"
    } as Control,

    clearAllButton: {
      type: "button",
      css: 'button:has-text("Clear All"), button:has-text("すべてクリア")',
      description: "Clear All filters button"
    } as Control,

    // Projects filter
    showInactiveProjectsCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"]',
      description: "Show inactive projects checkbox"
    } as Control,

    // Severity checkboxes
    criticalCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"][id*="Critical"], input[type="checkbox"] + label:has-text("Critical")',
      description: "Critical severity checkbox"
    } as Control,

    highCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"][id*="High"], input[type="checkbox"] + label:has-text("High")',
      description: "High severity checkbox"
    } as Control,

    mediumCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"][id*="Medium"], input[type="checkbox"] + label:has-text("Medium")',
      description: "Medium severity checkbox"
    } as Control,

    lowCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"][id*="Low"], input[type="checkbox"] + label:has-text("Low")',
      description: "Low severity checkbox"
    } as Control,

    unassignedCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"][id*="Unassigned"], input[type="checkbox"] + label:has-text("Unassigned")',
      description: "Unassigned severity checkbox"
    } as Control,

    // Published date filters
    publishedFromDate: {
      type: "textbox",
      css: 'input[name="published_from"]',
      description: "Published from date"
    } as Control,

    publishedToDate: {
      type: "textbox",
      css: 'input[name="published_to"]',
      description: "Published to date"
    } as Control,

    // Text search
    textSearchInput: {
      type: "textbox",
      css: 'input[placeholder*="Search"], input[placeholder*="検索"]',
      description: "Text search input"
    } as Control,

    // Search in checkboxes
    cveIdCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"] + label:has-text("CVE ID")',
      description: "Search in CVE ID checkbox"
    } as Control,

    vulnerabilityTitleCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"] + label:has-text("Vulnerability Title"), input[type="checkbox"] + label:has-text("脆弱性タイトル")',
      description: "Search in Vulnerability Title checkbox"
    } as Control,

    componentNameCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"] + label:has-text("Component Name"), input[type="checkbox"] + label:has-text("コンポーネント名")',
      description: "Search in Component Name checkbox"
    } as Control,

    componentVersionCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"] + label:has-text("Component Version"), input[type="checkbox"] + label:has-text("コンポーネントバージョン")',
      description: "Search in Component Version checkbox"
    } as Control,

    projectNameCheckbox: {
      type: "checkbox",
      css: 'input[type="checkbox"] + label:has-text("Project Name"), input[type="checkbox"] + label:has-text("プロジェクト名")',
      description: "Search in Project Name checkbox"
    } as Control,

    // CVSS filters
    cvssv2FromSpinbutton: {
      type: "spinbutton",
      css: '[role="spinbutton"][aria-label*="From"]:first-of-type',
      description: "CVSSv2 from value"
    } as Control,

    cvssv2ToSpinbutton: {
      type: "spinbutton",
      css: '[role="spinbutton"][aria-label*="To"]:first-of-type',
      description: "CVSSv2 to value"
    } as Control,

    cvssv3FromSpinbutton: {
      type: "spinbutton",
      css: '[role="spinbutton"][aria-label*="From"]:last-of-type',
      description: "CVSSv3 from value"
    } as Control,

    cvssv3ToSpinbutton: {
      type: "spinbutton",
      css: '[role="spinbutton"][aria-label*="To"]:last-of-type',
      description: "CVSSv3 to value"
    } as Control,

    // Action buttons
    exportButton: {
      type: "button",
      css: 'button:has-text("Export"), button:has-text("エクスポート")',
      description: "Export button"
    } as Control,

    refreshButton: {
      type: "button",
      css: 'img[aria-label="sync"]',
      description: "Refresh button"
    } as Control,

    columnSettingsButton: {
      type: "button",
      css: 'img[aria-label="insert-row-right"]',
      description: "Column settings button"
    } as Control,

    // Table
    vulnerabilityAuditTable: {
      type: "grid",
      css: 'main table, [role="table"]',
      description: "Vulnerability audit data table"
    } as Control,

   
    // Breadcrumb
    dashboardBreadcrumb: {
      type: "link",
      css: '[role="navigation"] [role="link"]:has-text("Dashboard"), [role="navigation"] [role="link"]:has-text("ダッシュボード")',
      description: "Dashboard breadcrumb link"
    } as Control
  };

  readonly Items = this.items(this.controls);

  async goto() {
    await this.page.goto(this.url);
    await this.waitForPageLoad();
  }

  async clearAllFilters() {
    await this.formEnter([this.controls.clearAllButton]);
  }

  async searchByText(searchText: string) {
    await this.formEnter([
      this.$(this.controls.textSearchInput, searchText)
    ]);
  }

  async setSeverityFilter(critical: boolean, high: boolean, medium: boolean, low: boolean, unassigned: boolean) {
    await this.formEnter([
      this.$(this.controls.criticalCheckbox, critical),
      this.$(this.controls.highCheckbox, high),
      this.$(this.controls.mediumCheckbox, medium),
      this.$(this.controls.lowCheckbox, low),
      this.$(this.controls.unassignedCheckbox, unassigned)
    ]);
  }

  async refreshData() {
    await this.formEnter([this.controls.refreshButton]);
  }

  

 
}
